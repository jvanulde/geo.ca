function cgpApiInit(){document.querySelectorAll(".cgp-custom-api-search-results").forEach((t=>{getCgpApiData({lang:t.getAttribute("data-lang"),htmlwrap:t.querySelector(".sc-cgp-api-ft-data"),apiurl:t.getAttribute("data-api-url"),resulturl:t.getAttribute("data-result-url"),searchurl:t.getAttribute("data-search-url"),datatype:t.getAttribute("data-type"),showpagination:parseInt(t.getAttribute("data-show-pagination")),numitemsperpage:parseInt(t.getAttribute("data-num-items-page")),maxitems:parseInt(t.getAttribute("data-max-items"))},{en:{org:"Organisation: ",pub:"Published: ",view:"View Record",nodata:"We're sorry, something went wrong, please refresh the page.",na:"N/A",viewmore:"View More",showless:"Show Less"},fr:{org:"Organisation : ",pub:"Publié  : ",view:"Afficher l'enregistrement",nodata:"Nous sommes désolés, quelque chose s'est mal passé. Veuillez rafraîchir la page",na:"N/A",viewmore:"Voir plus",showless:"Montrer moins"}})}))}function getCgpApiData(t,a){fetch(t.apiurl).then((function(t){return t.json()})).then((function(e){let r=e.Items.slice(0,t.maxitems);showCgpApiData(t,a,r)})).then((function(a){makeLeafletMap(t)})).catch((function(e){showCgpApiError(t,a),console.warn(a[t.lang].nodata,e)}))}function showCgpApiError(t,a){let e="";e+='<div class="sc-cgp-api-ft-data-results sc-cgp-api-error"',e+=`<p>${a[t.lang].nodata}</p>`,e+="</div>",t.htmlwrap.innerHTML=e}function showCgpApiData(t,a,e){let r,i="",s="",l="",n="",o="",c="",d="",p="",g=1,u="",m=1;i+='<div class="sc-cgp-api-ft-data-results" aria-live="polite">',e.forEach((e=>{l=e.title,n=e.id,o=e.organisation,c=e.coordinates,d=e.keywords,p=d.split(", "),r=e.published,resUrl=`${t.resulturl}?id=${n}&lang=${t.lang}`,resDesc=e.description,resDescExcerpt=resDesc.replace(/^(.{400}[^\s]*).*/,"$1")+" [...]",u="card data-card show",mapCSSID=`cgp-api-map-${t.datatype}-${m}`,1===t.showpagination&&m>t.numitemsperpage&&(u="card data-card hide"),i+=`<div class="${u}" data-page-group="${g}">`,i+='<div class="card-body">',i+='<div class="card-map-wrap">',i+=`<div class="card-leaflet-map-wrap"><div id="${mapCSSID}" data-map-id="${n}" data-map-coords="${c}" class="card-leaflet-map"></div></div>`,i+="</div>",i+='<div class="card-content-wrap">',i+=`<h3 class="card-title"><a href="${resUrl}" target="_blank">${l}</a></h3>`,i+=`<div class="card-keywords ${t.datatype}">`,i+='<ul class="list">',p=p.filter((t=>t));let s=1;for(keyword of p){let a=`${t.searchurl}?keyword=${keyword.toLowerCase()}&lang=${t.lang}`;i+=s<=5?`<li class="list-item"><a href="${a}" target="_blank">${keyword}</a></li>`:`<li class="list-item hidden"><a href="${a}" target="_blank">${keyword}</a></li>`,s++}p.length>5&&(i+=`<li class="list-item show-more"><a href="#" target="_blank">${a[t.lang].viewmore}</a></li>`),i+="</ul>",i+="</div>",i+='<div class="card-meta">',i+=`<p class="card-meta-item card-meta-item-org"><strong>${a[t.lang].org}</strong>${o}</p>`,i+=`<p class="card-meta-item card-meta-item-pub-date"><strong>${a[t.lang].pub}</strong>${r}</p>`,i+="</div>",i+='<div class="card-text">',i+=`<p>${resDescExcerpt}</p>`,i+="</div>",i+='<div class="card-button">',i+=`<p class="text-right"><a href="${resUrl}" target="_blank" class="btn btn-sm" aria-label="${l}">${a[t.lang].view}<i class="fas fa-long-arrow-alt-right"></i></a></p>`,i+="</div>",i+="</div>",i+="</div>",i+="</div>",m%t.numitemsperpage==0&&g++,m++})),i+="</div>";let h=0;if(e.length>t.numitemsperpage&&(h=Math.floor(e.length/t.numitemsperpage)),h>1&&1===t.showpagination){let t=1;for(s+=`<nav class="sc-cgp-api-ft-data-pagination" aria-label="Pagination Navigation" data-current-page-group="page-group-${t}">`,s+='<ul class="pagination-list">';t<=h;)s+=1==t?`<li class="pagination-list-item"><button class="pagination-btn current" data-page-num="${t}" aria-label="Current Page - Page ${t}" aria-current="true" aria-disabled="true">${t}</button></li>`:`<li class="pagination-list-item"><button class="pagination-btn" data-page-num="${t}" aria-label="Goto Page ${t}" aria-current="false">${t}</button></li>`,t++;s+="</ul>",s+="</nav>"}t.htmlwrap.innerHTML=i+s,paginationEl=t.htmlwrap.querySelector(".sc-cgp-api-ft-data-pagination"),h>1&&1===t.showpagination&&makeCgpAPIPagination(paginationEl),toggleKeywords(a,t)}function makeCgpAPIPagination(t){t.addEventListener("click",(function(a){if(a.target.hasAttribute("data-page-num")){a.preventDefault();let e=a.target.getAttribute("data-page-num"),r=t.closest(".sc-cgp-api-ft-data").querySelectorAll(".card"),i=t.querySelectorAll(".pagination-btn");for(btn of i)label=btn.getAttribute("aria-label"),btn.setAttribute("aria-label",label.replace("Current Page - ","")),btn.setAttribute("aria-disabled",!1),btn.setAttribute("aria-current",!1),btn.classList.remove("current");a.target.setAttribute("aria-label","Current Page - Page "+e),a.target.setAttribute("aria-current",!0),a.target.setAttribute("aria-disabled",!0),a.target.classList.add("current");for(let t of r){let a=t.getAttribute("data-page-group");t.classList.remove("show"),t.classList.add("hide"),e==a&&(t.classList.remove("hide"),t.classList.add("show"))}}}))}function toggleKeywords(t,a){const e=document.querySelectorAll(`.card-keywords.${a.datatype} .show-more`);for(let r of e)r.addEventListener("click",(function(e){e.preventDefault(),r.firstChild.textContent=r.firstChild.textContent===t[a.lang].viewmore?t[a.lang].showless:t[a.lang].viewmore;let i=r.parentElement.querySelectorAll(".list-item");for(let t of i)t.classList.contains("hidden")?(t.classList.add("show"),t.classList.remove("hidden")):t.classList.contains("show")&&(t.classList.add("hidden"),t.classList.remove("show"))}))}function makeLeafletMap(t,a,e){document.querySelectorAll(".card-leaflet-map").forEach((a=>{let e=a.getAttribute("id"),r=a.getAttribute("data-map-coords"),i=JSON.parse(r),s=(i.reverse(),[(i[0][2][1]+i[0][0][1])/2,(i[0][1][0]+i[0][0][0])/2]),l=40.7436654315252*Math.max(Math.abs(i[0][2][1]-i[0][0][1]),Math.abs(i[0][1][0]-i[0][0][0]))*11132/15,n=Math.max(Math.log2(36e5/l),1);if(e.includes(t.datatype)){var o=L.map(e).setView(s,n);L.tileLayer("https://geoappext.nrcan.gc.ca/arcgis/rest/services/BaseMaps/CBMT_CBCT_GEOM_3857/MapServer/WMTS/tile/1.0.0/BaseMaps_CBMT_CBCT_GEOM_3857/default/default028mm/{z}/{y}/{x}.jpg",{attribution:"© Her Majesty the Queen in Right of Canada, as represented by the Minister of Natural Resources"}).addTo(o);var c=[{type:"Feature",properties:{id:e,tag:"geoViewGeoJSON"},geometry:{type:"Polygon",coordinates:i}}];L.geoJSON(c).addTo(o)}}))}function getLeafletMap(t){console.log(`Trying to fetch Leaflet Data from ${t}`),fetch(t).then((function(t){return t.json()})).catch((function(t){console.warn(t)}))}cgpApiInit();
//# sourceMappingURL=cgp-api-sc-ft-data-min.js.map